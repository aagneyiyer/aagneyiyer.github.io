---
layout: page
title: Pixels
---
<style>
  .page-title {
    text-align: center;
    font-size: 2.5rem;
    font-weight: 600;
    margin: 2rem 0;
    color: #ffffff;
  }

  .calendar-container {
    max-width: 1400px;
    margin: 2rem auto;
    padding: 0 1rem;
    font-family: -apple-system, system-ui, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
  }
  
  .year-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 2.5rem;
    margin-top: 2rem;
  }
  
  /* Responsive breakpoints */
  @media screen and (max-width: 1200px) {
    .year-grid {
      grid-template-columns: repeat(3, 1fr);
    }
  }
  
  @media screen and (max-width: 900px) {
    .year-grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }
  
  @media screen and (max-width: 600px) {
    .year-grid {
      grid-template-columns: 1fr;
      gap: 2rem;
    }
    
    .month {
      max-width: 400px;
      margin: 0 auto;
      width: 100%;
    }
  }
  
  .month {
    background: #1a1a1a;
    border-radius: 8px;
    padding: 1.5rem;
    box-shadow: 0 4px 6px rgba(0,0,0,0.2);
  }
  
  .month-title {
    font-size: 1.3rem;
    font-weight: 600;
    margin-bottom: 1rem;
    color: #ffffff;
    text-align: center;
  }
  
  .days-grid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 3px;
  }
  
  .day-label {
    text-align: center;
    font-size: 0.8rem;
    color: #ffffff;
    padding: 0.4rem 0;
  }
  
  .day {
    aspect-ratio: 1;
    border-radius: 3px;
    border: 1px solid rgba(255, 255, 255, 0.2);
    cursor: pointer;
    transition: transform 0.2s;
    background-color: #2a2a2a;
  }
  
  .day:hover {
    transform: scale(1.1);
    border-color: rgba(255, 255, 255, 0.5);
  }
  
  .day.empty {
    background: transparent;
    border: none;
  }
  
  .legend {
    margin-top: 2rem;
    text-align: center;
    font-size: 1rem;
    color: #ffffff;
  }

  .mood-tooltip {
    position: absolute;
    background: rgba(0, 0, 0, 0.8);
    color: white;
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 12px;
    z-index: 10;
    white-space: nowrap;
    pointer-events: none;
  }

  .analytics {
    margin-top: 2rem;
    text-align: center;
    font-size: 1.1rem;
    color: #ffffff;
    padding: 1rem;
    background: rgba(0, 0, 0, 0.2);
    border-radius: 8px;
  }
</style>

<div class="calendar-container">
  <div class="page-title">Year in Pixels</div>
  <div class="legend">
    Rating every day and displaying it here via the Daylio app, Apple Shortcuts, and a custom API I wrote.
  </div>
  <div class="legend">
    Scale from 1 (awful) to 5 (goated)
  </div>
  <div class="year-grid" id="yearGrid"></div>
  <div class="analytics"></div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const yearGrid = document.getElementById('yearGrid');
  const analyticsDiv = document.querySelector('.analytics');
  const currentYear = new Date().getFullYear();
  const months = [
    'January', 'February', 'March', 'April',
    'May', 'June', 'July', 'August',
    'September', 'October', 'November', 'December'
  ];
  const weekDays = ['S', 'M', 'T', 'W', 'T', 'F', 'S'];

  const moodScores = {
    'goated': 5,
    'great': 4,
    'average': 3,
    'mid/stressful': 2,
    'awful': 1
  };

  function createMonth(monthIndex) {
    const monthDiv = document.createElement('div');
    monthDiv.className = 'month';
    
    const monthTitle = document.createElement('div');
    monthTitle.className = 'month-title';
    monthTitle.textContent = months[monthIndex];
    monthDiv.appendChild(monthTitle);
    
    const daysGrid = document.createElement('div');
    daysGrid.className = 'days-grid';
    
    // Add day labels
    weekDays.forEach(day => {
      const dayLabel = document.createElement('div');
      dayLabel.className = 'day-label';
      dayLabel.textContent = day;
      daysGrid.appendChild(dayLabel);
    });
    
    // Calculate first day of month and total days
    const firstDay = new Date(currentYear, monthIndex, 1).getDay();
    const totalDays = new Date(currentYear, monthIndex + 1, 0).getDate();
    
    // Add empty cells for days before the first of the month
    for (let i = 0; i < firstDay; i++) {
      const emptyDay = document.createElement('div');
      emptyDay.className = 'day empty';
      daysGrid.appendChild(emptyDay);
    }
    
    for (let day = 1; day <= totalDays; day++) {
      const dayDiv = document.createElement('div');
      dayDiv.className = 'day';
      // Ensure 2-digit month and day for consistent formatting
      const formattedMonth = String(monthIndex + 1).padStart(2, '0');
      const formattedDay = String(day).padStart(2, '0');
      const date = `${currentYear}-${formattedMonth}-${formattedDay}`;
      dayDiv.dataset.date = date;
      daysGrid.appendChild(dayDiv);
    }
    
    monthDiv.appendChild(daysGrid);
    return monthDiv;
  }

  function calculateMonthlyAnalytics(data) {
    const monthlyScores = {};
    
    // Initialize monthly scores
    months.forEach((month, index) => {
      monthlyScores[index] = {
        total: 0,
        count: 0,
        month: month
      };
    });

    // Calculate totals for each month
    Object.entries(data).forEach(([date, moodData]) => {
      const month = parseInt(date.split('-')[1]) - 1;
      const score = moodScores[moodData.mood];
      if (score) {
        monthlyScores[month].total += score;
        monthlyScores[month].count++;
      }
    });

    // Calculate averages and find best/worst months
    let bestMonth = null;
    let worstMonth = null;
    let bestAvg = -1;
    let worstAvg = 6;

    Object.entries(monthlyScores).forEach(([month, data]) => {
      if (data.count > 0) {
        const avg = data.total / data.count;
        data.average = avg;
        
        if (avg > bestAvg) {
          bestAvg = avg;
          bestMonth = data;
        }
        if (avg < worstAvg) {
          worstAvg = avg;
          worstMonth = data;
        }
      }
    });

    return { bestMonth, worstMonth };
  }

  async function fetchMoodColors() {
    try {
      const response = await fetch('https://mood-pi-three.vercel.app/api/refreshMood');
      const data = await response.json();
      
      // Calculate and display analytics
      const { bestMonth, worstMonth } = calculateMonthlyAnalytics(data);
      if (bestMonth && worstMonth) {
        analyticsDiv.textContent = `Best month so far: ${bestMonth.month} (${bestMonth.average.toFixed(2)}/5 average) | Worst month so far: ${worstMonth.month} (${worstMonth.average.toFixed(2)}/5 average)`;
      }
      
      // Apply colors to days
      Object.entries(data).forEach(([date, moodData]) => {
        const { color, mood } = moodData;
        const [year, month, day] = date.split('-');
        const normalizedDate = `${year}-${month.padStart(2, '0')}-${day.padStart(2, '0')}`;
        
        const dayElement = document.querySelector(`[data-date="${normalizedDate}"]`);
        if (dayElement) {
          dayElement.style.backgroundColor = color;
          dayElement.dataset.mood = mood;
          
          dayElement.addEventListener('mouseenter', () => {
            const tooltip = document.createElement('div');
            tooltip.className = 'mood-tooltip';
            tooltip.textContent = mood;
            dayElement.appendChild(tooltip);
          });
          
          dayElement.addEventListener('mouseleave', () => {
            const tooltip = dayElement.querySelector('.mood-tooltip');
            if (tooltip) {
              tooltip.remove();
            }
          });
        }
      });
    } catch (error) {
      console.error('Error:', error);
    }
  }

  // Create all months
  months.forEach((_, index) => {
    yearGrid.appendChild(createMonth(index));
  });

  // Initial fetch
  fetchMoodColors();
  
  // Refresh every 5 minutes
  setInterval(fetchMoodColors, 5 * 60 * 1000);
});
</script>